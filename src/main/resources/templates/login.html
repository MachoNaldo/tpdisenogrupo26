<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verificar Usuario</title>
  <link href="/css/estilos.css" rel="stylesheet" />
</head>
<body>
  <header class="header">
    <nav class="nav" aria-label="Navegaci칩n principal">
      <form action="/index" method="get">
        <button class="back-btn" aria-label="Regresar">&larr;</button>
      </form>
    </nav>
  </header>
  <main class="main">
    <section class="login-card">
      <div class="logo-container">
        <img src="img/Logotipo_2.png" alt="Logotipo 2" class="logo">
        <h1 class="brand-title">PREMIER</h1>
      </div>
      <!-- FORMULARIO -->
      <form id="loginForm" class="form">
        <label for="usuario" class="visually-hidden">Usuario</label>
        <input type="text" id="usuario" name="nombre" placeholder="Usuario" required>
        <label for="contrasena" class="visually-hidden">Contrase침a</label>
        <div class="password-wrapper">
          <input type="password" id="contrasena" name="contra" placeholder="Contrase침a" required>
          <span class="eye-icon" id="togglePassword" aria-hidden="true" style="cursor: pointer;">游뱖</span>
        </div>
        <button type="submit" class="btn">Verificar Usuario</button>
      </form>
    </section>
  </main>
  <footer class="footer"></footer>
  <!-- POPUP DE ERROR -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <p id="popup-message">Error</p>
      <button id="closePopup">Cerrar</button>
    </div>
  </div>
  <script>
    const form = document.getElementById('loginForm');
    const popup = document.getElementById('popup');
    const popupMessage = document.getElementById('popup-message');
    const closePopup = document.getElementById('closePopup');
    const usuarioInput = document.getElementById('usuario');
    const contrasenaInput = document.getElementById('contrasena');
    const togglePassword = document.getElementById('togglePassword');

    togglePassword.addEventListener('click', () => {
      const type = contrasenaInput.getAttribute('type') === 'password' ? 'text' : 'password';
      contrasenaInput.setAttribute('type', type);
      togglePassword.textContent = type === 'password' ? '游뱖' : '游뱁';
    });

    usuarioInput.addEventListener('input', () => {
      usuarioInput.classList.remove('input-error');
    });

    contrasenaInput.addEventListener('input', () => {
      contrasenaInput.classList.remove('input-error');
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      usuarioInput.classList.remove('input-error');
      contrasenaInput.classList.remove('input-error');

      const data = {
        nombre: usuarioInput.value,
        contra: contrasenaInput.value
      };

      try {
        const response = await fetch('/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });


        if (response.ok) {
          window.location.href = '/menu';
        } else {
          const result = await response.json();
          
          popupMessage.textContent = result.error || 'Usuario o contrase침a incorrectos';
          popup.style.display = 'flex';
          
          usuarioInput.classList.add('input-error');
          contrasenaInput.classList.add('input-error');
        
        }
      } catch (error) {
        console.error('Error en la petici칩n:', error);
        popupMessage.textContent = 'Error de conexi칩n';
        popup.style.display = 'flex';
        usuarioInput.classList.add('input-error');
        contrasenaInput.classList.add('input-error');
      }
    });

    closePopup.addEventListener('click', () => {
      popup.style.display = 'none';
    });
  </script>
</body>
</html>